package top.verytouch.vkit.chat.gpt.pojo;

import lombok.Data;
import top.verytouch.vkit.chat.common.ChatMessage;
import top.verytouch.vkit.common.util.JsonUtils;

import java.util.LinkedList;
import java.util.List;
import java.util.Optional;

/**
 * response for chatCompletions chunk
 *
 * @author verytouch
 * @since 2023/9/6 11:12
 */
@Data
public class ChunkResponse {

    private String id;

    private String object;

    private long created;

    private String model;

    private List<ChunkChoice> choices;

    public ChunkResponse mergeMessage(ChunkResponse another) {
        if (another == null || another.getChoices() == null || another.getChoices().isEmpty()) {
            return this;
        }
        ChatMessage anotherDelta = another.getChoices().get(0).getDelta();
        if (anotherDelta == null || anotherDelta.getContent() == null) {
            return this;
        }
        if (this.choices == null) {
            this.choices = new LinkedList<>();
        }
        if (this.choices.isEmpty() || this.choices.get(0) == null) {
            if (this.choices.get(0) == null) {
                this.choices.remove(0);
            }
            ChatMessage message = new ChatMessage();
            message.setContent("");
            ChunkChoice chunkChoice = new ChunkChoice();
            chunkChoice.setIndex(0);
            chunkChoice.setDelta(message);
            this.choices.add(chunkChoice);
        }
        ChunkChoice firstChoice = this.choices.get(0);
        if (firstChoice.getDelta() == null) {
            ChatMessage message = new ChatMessage();
            message.setContent("");
            this.choices.get(0).setDelta(message);
        }
        ChatMessage delta = this.choices.get(0).getDelta();
        String content = Optional.ofNullable(delta.getContent()).orElse("");
        delta.setContent(content + anotherDelta.getContent());
        return this;
    }

    public static void main(String[] args) {
        String json = "[{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"role\":\"assistant\",\"content\":\"\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":0}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"核\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"污\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":2}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"水\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"是\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"指\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"核\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"工\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"业\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"、\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"核\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"医\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":2}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"学\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"、\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"核\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"科\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"研\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":3}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"等\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"活\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"动\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"产\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"生\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"的\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"含\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"有\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"放\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"射\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":2}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"性\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"物\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"质\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":2}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"的\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"废\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":2}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"水\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"，\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"而\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"核\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"废\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":2}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"水\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"则\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"是\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"指\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"全部\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"的\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"核\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"工\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"业\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"产\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"生\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"的\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"含\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"放\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"射\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":2}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"性\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"物\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"质\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":2}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"的\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"废\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":2}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"水\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"。\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"可以\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"说\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"，\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"核\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"废\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":2}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"水\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"是\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"核\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"污\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":2}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"水\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"的\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"一个\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"更\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"广\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"泛\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":2}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"的\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"概\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":2}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"念\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":2}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"，\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"核\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"污\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":2}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"水\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"只\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"是\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"核\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"废\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":2}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"水\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"中\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"的\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"一\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"部\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"分\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"。\"}}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":1}},{\"id\":\"chatcmpl-7vezu5aXpym5ZkmmBwnP4RgQAf8tb\",\"object\":\"chat.completion.chunk\",\"created\":1693976646,\"model\":\"gpt-3.5-turbo-0613\",\"choices\":[{\"index\":0,\"delta\":{},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":0,\"completion_tokens\":0,\"total_tokens\":0}}]";
        List<ChunkResponse> responseList = JsonUtils.listFromJson(json, ChunkResponse.class);
        ChunkResponse response = responseList.stream().reduce(ChunkResponse::mergeMessage).get();
        System.out.println(JsonUtils.toJson(response));
        System.out.println(response.getChoices().get(0).getDelta().getContent());
    }
}
